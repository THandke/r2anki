---
title: "Untitled"
output: html_document
---

Todo:
- work with tibbles instead of data.frames
- wrap this code in functions
- make the arguments for the definition of "tasks" and "answers" (their beginning and ending) flexible
- test code with longer examples-files or files from the tidyverse-cookbook


```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)

# install.packages("tidyverse")
library(magrittr)
library(purrr)
```

## Read in test_sourcefile
```{r}
src <- readLines("examples/example_tasks.Rmd")
```


## Get line numbers for tasks and answers (code)
Maybe: define a function, that gets line numbers both for tasks and answers and writes them to a common object.
```{r}
# parse tasks
l_task <- grep("####", src)  # line of task  [alternative: grep("**Task**")]

# parse code
l_answer   <- grep("```", src)   # start and end lines of code-chunk
l_answer_s <- l_answer[seq(1, length(l_answer), 2)]  # all start lines
l_answer_e <- l_answer[seq(2, length(l_answer), 2)]  # all end lines
```


## Create an empty data frame to store tasks and answers
```{r}
src_dat <- data.frame(l_task   = integer(),
                     task     = character(),
                     l_answer_s = integer(),
                     l_answer_e = integer(),
                     stringsAsFactors = FALSE)
 
# write to the table
src_dat[seq_along(l_task), "l_task"] <- l_task
src_dat[seq_along(l_task), "task"] <- src[l_task]
src_dat[seq_along(l_answer_s), "l_answer_s"] <- l_answer_s
src_dat[seq_along(l_answer_e), "l_answer_e"] <- l_answer_e

#! define a function to get code-content
get_answer <- function(i){
  src[seq(l_answer_s[i] + 1, l_answer_e[i] - 1, 1)]
}

src_dat["code"] <- map(seq_along(l_answer_s), get_answer) %>% list
```


## write the data.frame/ tibble to a csv in the appropriate format


# Later: parse multiple files
```{r, eval=FALSE}
## Create two text files with content 
filenames <- c( tempfile(), tempfile() )
for( f in  filenames ){
 cat("We wish you a Merry Christmas!\n\nBest regards\n", file=f)
}

## Replace Merry Christmas with Happy New Year
for( f in filenames ){

  x <- readLines(f)
  y <- gsub( "Merry Christmas", "Happy New Year", x )
  cat(y, file=f, sep="\n")

}

## Review output
for( f in filenames ){ 
   cat(readLines(f), sep="\n")
}
```
